function dr(n){if($("#drawKanji").html(""),n!="")var t=new Dmak(n,{element:"drawKanji"})}(function(){"use strict";function r(t){for(var f=[],e,u,r,i=0;i<t.length;i++)for(r=0;r<t[i].length;r++)u=Raphael.getTotalLength(t[i][r].path),e={char:i,length:u,duration:u*n.options.step*1e3,path:t[i][r].path,groups:t[i][r].groups,text:t[i][r].text,object:{path:null,text:null}},f.push(e);return f}function u(t){for(var u=[],i,r=0;r<t;r++)i=new Raphael(n.options.element,n.options.width+"px",n.options.height+"px"),i.setViewBox(n.options.viewBox.x,n.options.viewBox.y,n.options.viewBox.w,n.options.viewBox.h),i.canvas.setAttribute("class","dmak-svg"),u.push(i);return u.reverse()}function f(t){for(var i=0;i<t.length;i++)t[i].path("M"+n.options.viewBox.w/2+",0 L"+n.options.viewBox.w/2+","+n.options.viewBox.h).attr(n.options.grid.attr),t[i].path("M0,"+n.options.viewBox.h/2+" L"+n.options.viewBox.w+","+n.options.viewBox.h/2).attr(n.options.grid.attr)}function e(i,r){i.object.text!==null&&i.object.text.remove();var u=function(){i.object.path.remove();i.object={path:null,text:null};r.shift()};n.options.stroke.animated.erasing?(i.object.path.node.style.stroke=n.options.stroke.attr.active,r.push(t(i,-1,u))):u()}function o(i,r,u){var f=function(){if(r.object.path!==null){var t=n.options.stroke.attr.stroke;n.options.stroke.attr.stroke==="random"&&(t=Raphael.getColor());r.object.path.node.style.stroke=t;r.object.path.node.style.transition=r.object.path.node.style.WebkitTransition="stroke 400ms ease";u.shift()}};r.object.path=i.path(r.path);r.object.path.attr(n.options.stroke.attr);n.options.stroke.order.visible&&s(i,r);n.options.stroke.animated.drawing?t(r,1,f):f()}function s(t,i){i.object.text=t.text(i.text.x,i.text.y,i.text.value);i.object.text.attr(n.options.stroke.order.attr)}function t(t,i,r){return t.object.path.attr({stroke:n.options.stroke.attr.active}),t.object.path.node.style.transition=t.object.path.node.style.WebkitTransition="none",t.object.path.node.style.strokeDasharray=t.length+" "+t.length,t.object.path.node.style.strokeDashoffset=i>0?t.length:0,t.object.path.node.getBoundingClientRect(),t.object.path.node.style.transition=t.object.path.node.style.WebkitTransition="stroke-dashoffset "+t.duration+"ms ease",t.object.path.node.style.strokeDashoffset=i>0?"0":t.length,setTimeout(r,t.duration)}function i(n,t){var u=n,r;if(arguments.length!==2)throw new Error("Missing arguments in extend function");for(r in t)typeof u[r]=="object"?u[r]=i(u[r],t[r]):u.hasOwnProperty(r)&&(u[r]=t[r]);return u}var n=function(t,r){if(this.text=t,this.options=i(n.options,r),this.strokes=[],this.papers=[],this.pointer=0,this.timeouts={play:[],erasing:[],drawing:[]},!this.options.skipLoad){var f=new DmakLoader(this.options.uri),u=this;f.load(t,function(n){u.prepare(n);u.options.loaded(u.kanjis);u.options.autoplay&&u.render()})}};n.VERSION="0.2.0";n.options={uri:"http://drawmeakanji.com/kanji/",skipLoad:!1,autoplay:!0,height:109,width:109,viewBox:{x:0,y:0,w:109,h:109},step:.01,element:"draw",stroke:{animated:{drawing:!0,erasing:!0},order:{visible:!1,attr:{"font-size":"8",fill:"#999999"}},attr:{active:"#BF0000",stroke:"#2C2C2C","stroke-width":4,"stroke-linecap":"round","stroke-linejoin":"round"}},grid:{show:!0,attr:{stroke:"#CCCCCC","stroke-width":.5,"stroke-dasharray":"--"}},loaded:function(){},erased:function(){},drew:function(){},done:function(){}};n.fn=n.prototype={prepare:function(n){this.kanjis=r(n);this.papers=u(n.length);this.options.grid.show&&f(this.papers)},erase:function(n){if(this.timeouts.play.length||this.pointer<=0)return!1;typeof n=="undefined"&&(n=0);do this.pointer--,e(this.kanjis[this.pointer],this.timeouts.erasing),this.options.erased(this.pointer);while(this.pointer>n)},render:function(t){if(this.timeouts.play.length)return!1;if(typeof t=="undefined")t=this.kanjis.length;else if(t>this.kanjis.length)return!1;for(var u=function(n){o(n.papers[n.kanjis[n.pointer].char],n.kanjis[n.pointer],n.timeouts.drawing);n.options.drew(n.pointer);n.pointer==n.kanjis.length-1&&n.options.done(n.pointer);n.pointer++;n.timeouts.play.shift()},r=0,i=0;i<this.timeouts.erasing.length;i++)window.clearTimeout(this.timeouts.erasing[i]),this.timeouts.erasing=[];for(i=this.pointer;i<t;i++)!n.options.stroke.animated.drawing||r<=0?u(this):this.timeouts.play.push(setTimeout(u,r,this)),r+=this.kanjis[i].duration},pause:function(){for(var n=0;n<this.timeouts.play.length;n++)window.clearTimeout(this.timeouts.play[n]);this.timeouts.play=[]},eraseLastStrokes:function(n){this.erase(this.pointer-n)},renderNextStrokes:function(n){this.render(this.pointer+n)}};window.Dmak=n})(),function(){"use strict";function t(n,u,f,e){var s=("00000"+f).slice(-5),o=i("GET",n+s+".svg");if(!o){alert("CORS not supported");return}if(s==="00020"||s==="03000"){e.done(u,{paths:[],texts:[]});return}o.onreadystatechange=function(){o.readyState===4&&(o.status===200?e.done(u,r(o.response,s)):(t(n,u,f,e),e.error(o.statusText)))};o.send()}function i(n,t){var i=new XMLHttpRequest;return"withCredentials"in i?i.open(n,t,!0):typeof XDomainRequest!="undefined"?(i=new XDomainRequest,i.open(n,t)):i=null,i}function r(n,t){function o(n){for(var i=n.childNodes,t=0;t<i.length;t++)i[t].tagName==="g"?(u.push(i[t].getAttribute("id")),o(i[t]),u.splice(u.indexOf(i[t].getAttribute("id")),1)):i[t].tagName==="path"&&f.push({path:i[t].getAttribute("d"),groups:u.slice(0)})}var f=[],e=(new DOMParser).parseFromString(n,"application/xml"),r=e.querySelectorAll("text"),u=[],i;for(o(e.getElementById("kvg:"+t)),i=0;i<r.length;i++)f[i].text={value:r[i].textContent,x:r[i].getAttribute("transform").split(" ")[4],y:r[i].getAttribute("transform").split(" ")[5].replace(")","")};return f}var n=function(n){this.uri=n};n.prototype.load=function(n,i){for(var u=[],f=n.length,e=0,o={done:function(n,t){u[n]=t;e++;e===f&&i(u)},error:function(n){console.log("Error",n)}},r=0;r<f;r++)t(this.uri,r,n.charCodeAt(r).toString(16),o)};window.DmakLoader=n}();$(document).ready(function(){$("#dline").length&&$("#dline").sketch();$("#dr").keydown(function(n){var t=n.keyCode?n.keyCode:n.which;if(t=="13")return $("#btnDraw").trigger("click"),!1});$("#btnDraw").on("click",function(){dr($("#draw-text").val());$("#draw-text").focus()});$(".drawKanji").on("click",function(){return $("#txtKanji").val($(this).text()),dr($(this).text()),$("#drawingModal").modal(),!1});$("#btnReDraw").on("click",function(){})});
/*
//# sourceMappingURL=dmak.min.js.map
*/