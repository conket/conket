function supportType(n){var t=document.createElement("audio"),i=t.canPlayType&&t.canPlayType(n);return i==""?!1:!0}var ua=navigator.userAgent.toLowerCase(),isAndroid=/android/.test(ua),isiOs=/(iphone|ipod|ipad)/.test(ua),isStandAlone=window.navigator.standalone,isiPad=ua.match(/ipad/),isDevice="ontouchstart"in window,isChrome="chrome"in window,isMoz="mozAnimationStartTime"in window;String.prototype.asId=function(){return this.replace(/[^a-zA-Z0-9_]+/g,"")},function(n){function t(t){this.name=typeof t=="string"?t:t.mp3.split(".")[0].asId();this.soundInPlay=null;this.playingSounds=[];this.isMuted=!1;n.mbAudio.ch.push(this)}n.mbAudio={name:"mb.audio",author:"Matteo Bicocchi",version:"1.5",defaults:{id:"",ogg:"",mp3:"",loop:!1,volume:10},sounds:{},players:{},loaded:{},playing:[],ch:[],soundsMutedByHand:!1,build:function(t){var r,i,u;if(!n.mbAudio.isInit){n(window).on("blur",function(){n.mbAudio.soundsMutedByHand=!0;n.mbAudio.muteAllSounds()}).on("focus",function(){n.mbAudio.soundsMutedByHand=!1;n.mbAudio.unMuteAllSounds()});n.mbAudio.isInit=!0}r=typeof t=="string"?n.mbAudio.sounds[t]:t;i=r.id?r.id:typeof t=="string"?t:t.mp3.split(".")[0].asId();n.mbAudio.loaded[i]!=1&&(u=supportType("audio/mpeg")?r.mp3:r.ogg,n.mbAudio.players[i]=new Audio(u),n.mbAudio.players[i].load(),n.mbAudio.players[i].pause(),n.mbAudio.loaded[i]=1)},YTPGetPlayer:function(t){var u=document.getElementById("mbAudio_"+t),i,r;return n(u).length!=0&&n.mbAudio.players[t]||(i=typeof t=="string"?n.mbAudio.sounds[t]:t,r=i.id?i.id:typeof sound=="string"?sound:sound.mp3.split(".")[0].asId(),t=r),n.mbAudio.players[t]},preload:function(){for(var t in n.mbAudio.sounds)n.mbAudio.build(t);n(document).trigger("soundsLoaded")},play:function(t,i,r){var e=typeof t=="string"?n.mbAudio.sounds[t]:t,u,h,c;if(alert(n.mbAudio.name),!e){alert(i);return}var f=e.id?e.id:typeof t=="string"?t:t.mp3.split(".")[0].asId(),s=e.loop?e.loop:n.mbAudio.defaults.loop,o=typeof e.volume=="number"?e.volume:n.mbAudio.defaults.volume;if(o=o>10?10:o,n.mbAudio.build(t),u=n.mbAudio.YTPGetPlayer(f),u.vol=o,u.volume=n.mbAudio.allMuted?0:u.vol/10,n(u).off("ended."+f+",paused."+f),typeof i=="undefined"&&(i=!0),i&&(typeof i=="string"||typeof i=="object")){i=typeof i=="string"?e.sprite[i]:i;clearTimeout(u.timeOut);isAndroid||u.seekable.length!=0?n.mbAudio.manageSprite(u,f,t,i,r):(u.pause(),h=setInterval(function(){u.seekable.length>0&&u.seekable.end(0)>=i.end-1&&(clearInterval(h),n.mbAudio.manageSprite(u,f,t,i,r))},1));return}if(s)n(u).one("ended."+f+",paused."+f,function(){if(this.currentTime=0,typeof s=="number"&&(typeof u.counter=="undefined"&&(u.counter=0),u.counter++,u.counter===s)){delete u.counter;n.mbAudio.playing.splice(f,1);delete u.isPlaying;typeof r=="function"&&r(u);return}n.mbAudio.play(t,i,r)});else n(u).on("ended."+f+",paused."+f,function(){n.mbAudio.playing.splice(f,1);delete u.isPlaying;typeof r=="function"&&r(u)});u.pause();u.currentTime&&i&&(u.currentTime=0);u.play();c=jQuery.inArray(f,n.mbAudio.playing);n.mbAudio.playing.splice(c,1);n.mbAudio.playing.push(f);u.isPlaying=!0},manageSprite:function(t,i,r,u,f){function e(n,t,i,r,u){n.currentTime=r.start;Math.round(n.currentTime)!=Math.round(r.start)?setTimeout(function(){e(n,t,i,r,u)},5):o(n,t,i,r,u)}function o(t,i,r,u,f){var o=(u.end-u.start)*1e3+100,e=!0;t.play();t.isPlaying=!0;t.timeOut=setTimeout(function(){u.loop?(e=!1,u.loop=u.loop==!0?9999:u.loop,t.counter||(t.counter=1),t.counter!=u.loop&&t.isPlaying?(t.counter++,t.currentTime=u.start||0,n.mbAudio.play(r,u,f)):(t.counter=0,e=!0,t.pause(),delete t.isPlaying)):(t.pause(),delete t.isPlaying);e&&typeof f=="function"&&f(t);var o=jQuery.inArray(i,n.mbAudio.playing);n.mbAudio.playing.splice(o,1)},o);n.mbAudio.playing.push(i);t.isPlaying=!0}t.pause();e(t,i,r,u,f)},stop:function(t,i){var f,u,r,e;t&&(f=typeof t=="string"?n.mbAudio.sounds[t]:t,f)&&(u=f.id?f.id:typeof t=="string"?t:t.mp3.split(".")[0].asId(),r=n.mbAudio.YTPGetPlayer(u),n.mbAudio.loaded[u]!=1&&n.mbAudio.build(t),r.pause(),r.currentTime&&(r.currentTime=0),n(r).off("ended."+u),typeof i=="function"&&i(r),e=jQuery.inArray(u,n.mbAudio.playing),n.mbAudio.playing.splice(e,1),delete r.isPlaying,delete r.counter)},pause:function(t,i){var e=typeof t=="string"?n.mbAudio.sounds[t]:t,u=e.id?e.id:typeof t=="string"?t:t.mp3.split(".")[0].asId(),r,f;n.mbAudio.loaded[u]!=1&&n.mbAudio.build(t);r=n.mbAudio.YTPGetPlayer(u);r.pause();n(r).off("ended."+u);f=jQuery.inArray(u,n.mbAudio.playing);f>-1&&n.mbAudio.playing.splice(f,1);delete r.isPlaying;delete r.counter;clearTimeout(r.timeOut);typeof i=="function"&&i()},destroy:function(t){var u=typeof t=="string"?n.mbAudio.sounds[t]:t,i=u.id?u.id:typeof t=="string"?t:t.mp3.split(".")[0].asId(),f,r;(n.mbAudio.loaded[i]=0,f=jQuery.inArray(i,n.mbAudio.playing),n.mbAudio.playing.splice(f,1),r=n.mbAudio.YTPGetPlayer(i),r)&&n(r).remove()},muteAllSounds:function(){var i=n.mbAudio.loaded,r,t;if(i){for(r in i)t=n.mbAudio.YTPGetPlayer(r),t.vol=t.volume*10,t.volume=0;n.mbAudio.allMuted=!0}},unMuteAllSounds:function(){var i=n.mbAudio.loaded,r,t;if(i){for(r in i)t=n.mbAudio.YTPGetPlayer(r),t.volume=t.vol/10;n.mbAudio.allMuted=!1}},stopAllSounds:function(){var t=n.mbAudio.loaded,i;if(t){for(i in t)n.mbAudio.destroy(i);n.mbAudio.allMuted=!0}},setVolume:function(t,i){var u=typeof t=="string"?n.mbAudio.sounds[t]:t,f=u.id?u.id:typeof t=="string"?t:t.mp3.split(".")[0].asId(),r;n.mbAudio.loaded[f]!=1&&n.mbAudio.build(t);r=n.mbAudio.YTPGetPlayer(f);i=i>10?10:i;r.vol=i;r.volume=r.vol},fadeIn:function(t,i,r,u){var o,s,f,e,c,h;r||(r=3e3);r=r/4;o=typeof t=="string"?n.mbAudio.sounds[t]:t;s=o.id?o.id:typeof t=="string"?t:t.mp3.split(".")[0].asId();n.mbAudio.loaded[s]!=1&&n.mbAudio.build(t);f=n.mbAudio.YTPGetPlayer(s);e=typeof o.volume=="number"?o.volume:n.mbAudio.defaults.volume;e=e>10?10:e;c=e/10/r;clearInterval(f.fade);f.play();f.currentTime&&(f.currentTime=0);f.volume=0;n.mbAudio.allMuted||(h=0,f.fade=setInterval(function(){if(h>=e/10){clearInterval(f.fade);typeof u=="function"&&u(f);return}f.volume=h;h+=c},0));n.mbAudio.playing.push(s);f.isPlaying=!0},fadeOut:function(t,i,r){var e,s,u,f,h,o;i||(i=3e3);i=i/4;e=typeof t=="string"?n.mbAudio.sounds[t]:t;s=e.id?e.id:typeof t=="string"?t:t.mp3.split(".")[0].asId();n.mbAudio.loaded[s]!=1&&n.mbAudio.build(t);u=n.mbAudio.YTPGetPlayer(s);f=u.volume?u.volume*10:typeof e.volume=="number"?e.volume:n.mbAudio.defaults.volume;f=f>10?10:f;h=f/10/i;clearInterval(u.fade);u.volume=f/10;u.play();o=u.volume;u.fade=setInterval(function(){if(o<=0){o=0;clearInterval(u.fade);u.volume=0;u.isPlaying=!1;var t=jQuery.inArray(s,n.mbAudio.playing);n.mbAudio.playing.splice(t,1);u.pause();typeof r=="function"&&r(u);return}u.volume=o;o-=h},0)},queue:{isStarted:!1,add:function(i,r,u,f){var h=typeof i=="string"?i:i.mp3.split(".")[0].asId(),o=n.mbAudio.queue.get(h),s,e;o==null&&(o=new t(i));s=typeof i=="string"?n.mbAudio.sounds[i]:i;s.started||(n.mbAudio.pause(i),s.started=!0);r=typeof r=="string"?s.sprite[r]:r;e={};e.soundID=i;e.sprite=r;e.channel=o;e.hasPriority=f;e.callback=u;n.mbAudio.queue.isStarted||n.mbAudio.queue.startEngine();n.mbAudio.soundsMutedByHand||(e.hasPriority?(e.channel.playingSounds.splice(0,1),e.channel.soundInPlay=null,o.playingSounds.unshift(e)):o.playingSounds.push(e))},get:function(t){for(var i in n.mbAudio.ch)if(n.mbAudio.ch[i].name==t)return n.mbAudio.ch[i]},manage:function(){function r(t){if(t.soundInPlay==null&&t.playingSounds&&t.playingSounds.length>0&&!n.mbAudio.soundsMutedByHand&&!t.isMuted){t.soundInPlay=t.playingSounds[0];function i(){typeof t.soundInPlay.callback=="function"&&t.soundInPlay.callback();t.playingSounds.splice(0,1);t.soundInPlay=null}n.mbAudio.play(t.soundInPlay.soundID,t.soundInPlay.sprite,i)}else t.soundInPlay!=null&&t.soundInPlay.soundID&&(n.mbAudio.soundsMutedByHand||t.isMuted)&&(n.mbAudio.pause(t.soundInPlay.soundID),t.playingSounds=[],t.playingSounds.unshift(t.soundInPlay),t.soundInPlay=null)}var t,i;for(t in n.mbAudio.ch)i=n.mbAudio.ch[t],r(i)},mute:function(t){if(t){var i=n.mbAudio.queue.get(t);i&&(i.isMuted=!0);n.mbAudio.pause(t)}else n.mbAudio.soundsMutedByHand=!0},unMute:function(t){if(t){var i=n.mbAudio.queue.get(t);i&&(i.isMuted=!1)}else n.mbAudio.soundsMutedByHand=!1},clear:function(t){var i=n.mbAudio.queue.get(t);i&&(i.soundInPlay!=null&&n.mbAudio.pause(i.soundInPlay.soundID),i.soundInPlay=null,i.playingSounds=[])},startEngine:function(){n.mbAudio.channelsEngine=setInterval(n.mbAudio.queue.manage,1);n.mbAudio.queue.isStarted=!0},stopEngine:function(){clearInterval(n.mbAudio.channelsEngine);n.mbAudio.queue.isStarted=!1}}}}(jQuery);
/*
//# sourceMappingURL=jquery.mb.audio.min.js.map
*/